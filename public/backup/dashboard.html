<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Project Gauss</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="navbar-content">
      <a href="/dashboard.html" class="navbar-brand"><img src="/img/gauss-logo.png" alt="Project Gauss"> Project Gauss</a>
      <ul class="navbar-nav">
        <li><a href="/dashboard.html" class="active">Dashboard</a></li>
        <li><a href="/posts.html">Post</a></li>
        <li><a href="/spotted.html">Spotted</a></li>
        <li><a href="/profile.html">Profilo</a></li>
      </ul>
      <div class="navbar-user">
        <span class="user-info" id="nav-user-name"></span>
        <span class="user-role" id="nav-user-role"></span>
        <button class="btn btn-secondary btn-sm" id="btn-logout">Esci</button>
      </div>
    </div>
  </nav>

  <main class="container">
    <div class="page-header">
      <h1>Dashboard</h1>
      <p id="welcome-text">Benvenuto nel tuo pannello di controllo</p>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
    </div>

    <div id="dashboard-content" class="hidden">

      <!-- Tab navigation (admin only) -->
      <div id="admin-tabs" class="dash-tabs hidden">
        <button class="dash-tab active" data-tab="overview">Panoramica</button>
        <button class="dash-tab" data-tab="moderation">
          Moderazione
          <span class="tab-badge hidden" id="mod-badge">0</span>
        </button>
        <button class="dash-tab" data-tab="school-requests">
          Richieste scuole
          <span class="tab-badge hidden" id="school-req-badge">0</span>
        </button>
        <button class="dash-tab" data-tab="users">Utenti</button>
      </div>

      <div id="alert" class="alert"></div>

      <!-- ====== TAB: Panoramica ====== -->
      <div class="tab-panel active" id="panel-overview">

        <!-- Stats (visibili ad admin e rappresentante) -->
        <div id="stats-section" class="hidden">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="stat-total">0</div>
              <div class="stat-label">Utenti totali</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-studenti">0</div>
              <div class="stat-label">Studenti</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-rappresentanti">0</div>
              <div class="stat-label">Rappresentanti</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-admin">0</div>
              <div class="stat-label">Admin / Co-Admin</div>
            </div>
          </div>
        </div>

        <!-- Card profilo rapido -->
        <div class="card">
          <h2>Il tuo profilo</h2>
          <div class="profile-summary">
            <div class="profile-avatar" id="profile-avatar">U</div>
            <div class="profile-details">
              <p><strong>Nome:</strong> <span id="profile-name">-</span></p>
              <p><strong>Email:</strong> <span id="profile-email">-</span></p>
              <p><strong>Ruolo:</strong> <span id="profile-role">-</span></p>
              <p><strong>Classe:</strong> <span id="profile-classe">-</span></p>
              <p id="profile-bio-row"><strong>Bio:</strong> <span id="profile-bio">-</span></p>
            </div>
          </div>
          <p style="margin-top: 16px;">
            <a href="/profile.html" class="btn btn-primary" style="width: auto; border-radius: 999px; padding: 10px 24px;">Modifica profilo</a>
          </p>
        </div>

        <!-- Lista studenti recenti (per rappresentante e admin) -->
        <div id="recent-users-section" class="hidden">
          <div class="card">
            <h2>Studenti recenti</h2>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Ruolo</th>
                    <th>Classe</th>
                  </tr>
                </thead>
                <tbody id="recent-users-table"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Aggiungi scuola (admin e rappresentante) -->
        <div id="add-school-section" class="hidden">
          <div class="card">
            <div class="card-header-row">
              <h2>üè´ Scuole</h2>
              <button class="btn btn-sm" id="btn-toggle-school-form" style="font-size: 0.78rem; padding: 5px 14px; border-radius: 999px; background: var(--primary-light); color: var(--primary); border: none; font-weight: 700;">+ Aggiungi</button>
            </div>

            <!-- Lista scuole -->
            <div id="schools-list" class="schools-list"></div>
            <div id="no-schools" class="empty-state hidden">
              <div class="empty-icon">üè´</div>
              <p>Nessuna scuola registrata</p>
            </div>

            <!-- Form aggiungi/modifica scuola -->
            <div id="school-form-wrapper" class="hidden" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
              <h3 id="school-form-title">Aggiungi scuola</h3>
              <form id="form-add-school">
                <input type="hidden" id="school-edit-id" value="">
                <div class="form-row">
                  <div class="form-group">
                    <label for="school-name">Nome scuola *</label>
                    <input type="text" id="school-name" required placeholder="Es: IIS Leonardo da Vinci">
                  </div>
                  <div class="form-group">
                    <label for="school-city">Citt√† *</label>
                    <input type="text" id="school-city" required placeholder="Es: Milano">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="school-province">Provincia</label>
                    <input type="text" id="school-province" placeholder="Es: MI" maxlength="2">
                  </div>
                  <div class="form-group">
                    <label for="school-address">Indirizzo</label>
                    <input type="text" id="school-address" placeholder="Es: Via Roma 1">
                  </div>
                </div>
                <div class="form-group">
                  <label for="school-logo">URL logo scuola</label>
                  <input type="url" id="school-logo" placeholder="https://esempio.it/logo.png">
                  <div id="school-logo-preview" class="school-logo-preview hidden">
                    <img id="school-logo-img" src="" alt="Preview logo">
                  </div>
                </div>
                <div class="form-group">
                  <label for="school-description">Descrizione</label>
                  <textarea id="school-description" rows="3" placeholder="Una breve descrizione della scuola..."></textarea>
                </div>
                <div class="form-actions-row">
                  <button type="submit" class="btn btn-primary" style="width: auto;">Salva scuola</button>
                  <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-school" style="background: var(--border); color: var(--text); border: none;">Annulla</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- ====== TAB: Moderazione Spotted (admin) ====== -->
      <div class="tab-panel" id="panel-moderation">
        <div class="card">
          <div class="card-header-row">
            <h2>Spotted in attesa</h2>
            <span class="counter-badge" id="pending-count-label">0 in attesa</span>
          </div>
          <div id="pending-spotted-list"></div>
          <div id="no-pending" class="empty-state hidden">
            <div class="empty-icon">‚úì</div>
            <p>Nessuno spotted in attesa di approvazione</p>
          </div>
        </div>
      </div>

      <!-- ====== TAB: Richieste scuole (admin) ====== -->
      <div class="tab-panel" id="panel-school-requests">
        <div class="card">
          <div class="card-header-row">
            <h2>Richieste di nuove scuole</h2>
            <span class="counter-badge" id="school-req-count-label">0 in attesa</span>
          </div>
          <div id="school-requests-list"></div>
          <div id="no-school-requests" class="empty-state hidden">
            <div class="empty-icon">‚úì</div>
            <p>Nessuna richiesta di scuola in attesa</p>
          </div>
        </div>
      </div>

      <!-- ====== TAB: Gestione utenti (admin) ====== -->
      <div class="tab-panel" id="panel-users">
        <!-- Filtri -->
        <div class="card">
          <h3>Filtra utenti</h3>
          <div class="filter-row">
            <div class="form-group">
              <label for="filter-role">Ruolo</label>
              <select id="filter-role">
                <option value="">Tutti</option>
                <option value="studente">Studente</option>
                <option value="rappresentante">Rappresentante</option>
                <option value="co_admin">Co-Admin</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-classe">Classe</label>
              <input type="text" id="filter-classe" placeholder="Es: 5">
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
              <button class="btn btn-primary" id="btn-filter" style="width: auto;">Filtra</button>
            </div>
          </div>
        </div>

        <!-- Lista utenti -->
        <div class="card">
          <div class="card-header-row">
            <h2>Utenti</h2>
            <span class="counter-badge" id="users-count-label">0 utenti</span>
          </div>
          <div id="users-list"></div>
        </div>
      </div>

    </div>
  </main>

  <!-- Modale Ban/Kick -->
  <div class="modal-overlay hidden" id="ban-modal">
    <div class="modal">
      <div class="modal-header">
        <h3 id="ban-modal-title">Azione utente</h3>
        <button class="modal-close" id="ban-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 16px;">Scegli un'azione per <strong id="ban-user-name"></strong>:</p>
        <div class="ban-options">
          <label class="ban-option">
            <input type="radio" name="ban-action" value="kick" checked>
            <div class="ban-option-content">
              <span class="ban-option-label">‚è± Sospensione temporanea</span>
              <span class="ban-option-desc">L'utente non potr√† accedere per un periodo limitato</span>
            </div>
          </label>
          <label class="ban-option">
            <input type="radio" name="ban-action" value="ban">
            <div class="ban-option-content">
              <span class="ban-option-label">üö´ Ban permanente</span>
              <span class="ban-option-desc">L'utente sar√† bloccato definitivamente</span>
            </div>
          </label>
        </div>
        <div id="kick-duration-group" class="form-group" style="margin-top: 16px;">
          <label for="kick-duration">Durata sospensione (ore)</label>
          <input type="number" id="kick-duration" value="24" min="1" max="8760">
        </div>
        <div class="form-group" style="margin-top: 12px;">
          <label for="ban-reason">Motivo (opzionale)</label>
          <input type="text" id="ban-reason" placeholder="Specifica il motivo...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="ban-modal-cancel" style="background: var(--border); color: var(--text); border: none;">Annulla</button>
        <button class="btn btn-danger" id="ban-modal-confirm">Conferma</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <img src="/img/gauss-logo.png" alt="Project Gauss"> Project Gauss
      </div>
      <div class="footer-credits">
        Sviluppato e manutenuto da <a href="#">Cristian Ceni</a>
      </div>
    </div>
  </footer>

  <nav class="bottom-nav">
    <ul class="bottom-nav-items">
      <li><a href="/dashboard.html" class="active"><span class="nav-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>Home</a></li>
      <li><a href="/posts.html"><span class="nav-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></span>Post</a></li>
      <li><a href="/spotted.html"><span class="nav-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>Spotted</a></li>
      <li><a href="/profile.html"><span class="nav-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>Profilo</a></li>
    </ul>
  </nav>

  <script src="/js/api.js"></script>
  <script src="/js/dashboard.js"></script>
</body>
</html>
